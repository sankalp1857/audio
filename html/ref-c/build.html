<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0016)http://localhost -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<title>TrulyNatural SDK: Custom Recognition</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="C Docs (7.4.0)"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 64px;">
  <td id="projectlogo"><img alt="Logo" src="sensory96.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TrulyNatural SDK
   &#160;<span id="projectnumber">7.4.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<div id="language">
  <ul class="sm sm-dox" id="language-menu">
    <li id="label">API Language:</li>
    <li><a href="../ref-c/index.html" class="current">C</a></li>
    <li><a href="../ref-java/index.html">Java</a></li>
  </ul>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('build.html','');});
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Custom Recognition </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>TrulyNatural SDKs 6.7.0 and later include support for building LVCSR recognizers with custom recognition language and vocabulary.</p>
<ul>
<li><a class="el" href="build.html#build-motivation">Why use a custom recognizer?</a></li>
<li><a class="el" href="build.html#build-cmdline">Creating a recognizer with the command-line tools</a></li>
<li><a class="el" href="build.html#build-code">Creating a recognizer using the API</a></li>
<li><a class="el" href="build.html#grammar-syntax">Grammar Specification Syntax</a></li>
</ul>
<h1><a class="anchor" id="build-motivation"></a>
Why use a custom recognizer?</h1>
<p>Reasons to use a custom LVCSR recognizer include:</p><ul>
<li>The vocabulary is not known during application build time. For example: A list of contact names from an address book.</li>
<li>The target device doesn't have enough CPU cycles or RAM available to run a large broad-domain language model recognizer such as <em>lvcsr-broad-1.1.0.snsr</em>.</li>
<li>The task domain includes specialized vocabulary not included in the broad domain model.</li>
<li>Customized, domain-specific models typically trade flexibility for lower error rates.</li>
<li>Prototyping.</li>
</ul>
<h1><a class="anchor" id="build-cmdline"></a>
Creating a recognizer with the command-line tools</h1>
<p>data/grammars/enrollments.txt contains a sample grammar specification that matches the enrollment recordings in <em>data/enrollments/</em>:</p>
<div class="fragment"><div class="line"># LVCSR grammar specification for test utternances in data/enrollments/</div><div class="line">#</div><div class="line"></div><div class="line"># In a tpl-spot-vad-lvcsr pipeline the prefix would be consumed by the spotter.</div><div class="line">prefix = armadillo | jackalope | terminator;</div><div class="line"></div><div class="line"># List of known utterances in the *-c.wav files.</div><div class="line">sentence =</div><div class="line"> 18 percent of 643 |</div><div class="line"> call the nearest target |</div><div class="line"> how far away is winco |</div><div class="line"> play more songs by this artist |</div><div class="line"> record a video |</div><div class="line"> start a timer for 20 minutes |</div><div class="line"> i&#39;m running low on gas |</div><div class="line"> cancel all my meetings on friday |</div><div class="line"> directions to susan&#39;s house |</div><div class="line"> do i have any new texts |</div><div class="line"> open my calendar to next week |</div><div class="line"> set an alarm for 6 am tomorrow;</div><div class="line"></div><div class="line"># Match the prefix and zero or one of the sentences.</div><div class="line"># &lt;s&gt; and &lt;/s&gt; are sentence start and end markers that</div><div class="line"># match silence and small amounts of extraneous speech.</div><div class="line">g = &lt;s&gt; $prefix $sentence? &lt;/s&gt;;</div></div><!-- fragment --><p>We can create a custom recognizer using this grammar with <a class="el" href="tools.html#snsr-edit">snsr-edit</a> by specifying a source recognizer that supports building, and the <a class="el" href="group__task-spot.html#ga43b5ed48ada5a1574df79fc663194bcc">SNSR_GRAMMAR_STREAM</a> setting:</p>
<div class="fragment"><div class="line">$ bin/snsr-edit -vv -t model/lvcsr-build-enUS-2.7.0.snsr\</div><div class="line">  -f grammar-stream data/grammars/enrollments.txt</div><div class="line">Loading &quot;model/lvcsr-build-enUS-2.7.0.snsr&quot; as the template model.</div><div class="line">Loading &quot;data/grammars/enrollments.txt&quot; into setting &quot;grammar-stream&quot;.</div><div class="line">Saved edited model to &quot;edited-model.snsr&quot;.</div></div><!-- fragment --><p>Run the new recognizer using <a class="el" href="tools.html#snsr-eval">snsr-eval</a> (we're setting <a class="el" href="group__task-spot.html#ga16d19fc683ef633ef03b7dca3922eaff">SNSR_PARTIAL_RESULT_INTERVAL</a> to <code>0</code> for less verbose output):</p>
<div class="fragment"><div class="line">$ snsr-eval -t edited-model.snsr\</div><div class="line">  -s partial-result-interval=0\</div><div class="line">  data/enrollments/armadillo-1-3-c.wav</div><div class="line">   180   2775 armadillo play more songs by this artist</div></div><!-- fragment --><p>For small grammars such as this the build time is negligible. We could use <a class="el" href="tools.html#snsr-eval">snsr-eval</a> to build and run the recognizer in a single operation:</p>
<div class="fragment"><div class="line">$ bin/snsr-eval -t model/lvcsr-build-enUS-2.7.0.snsr\</div><div class="line">  -s partial-result-interval=0\</div><div class="line">  -f grammar-stream data/grammars/enrollments.txt\</div><div class="line">  data/enrollments/jackalope-1-1-c.wav</div><div class="line">   300   2640 jackalope cancel all my meetings on friday</div><div class="line"></div><div class="line">$ bin/snsr-eval -t model/lvcsr-build-enUS-2.7.0.snsr\</div><div class="line">  -s partial-result-interval=0\</div><div class="line">  -f grammar-stream data/grammars/enrollments.txt\</div><div class="line">  data/enrollments/armadillo-1-5-c.wav</div><div class="line">   345   2595 armadillo start a timer for 20 minutes</div></div><!-- fragment --><h2><a class="anchor" id="build-class"></a>
Class-based recognition</h2>
<p>A terminal that starts with with a tilde, <span class="tag">~</span>, specifies a recognition class. Class recognizers have their own grammar specifications, separate from the top-level grammar. The behavior of a class-based recognizer is similar to that specified by a rule. Classes, however, can be updated without recompiling the rest of the grammar, and all references to a class use the same recognizer. This can reduce the recognizer size, and improve build speed.</p>
<p>This example uses a modified enrollment grammar which references two toy classes: ~number and ~place:</p>
<div class="fragment"><div class="line"># enrollments-class.txt</div><div class="line">#</div><div class="line"># LVCSR grammar specification for test utternances in data/enrollments/</div><div class="line"># This references two class sub-recognizers: ~number and ~place</div><div class="line">#</div><div class="line"># In a tpl-spot-vad-lvcsr pipeline the prefix would be consumed by the spotter.</div><div class="line">prefix = armadillo | jackalope | terminator;</div><div class="line"></div><div class="line"># List of known utterances in the *-c.wav files.</div><div class="line">sentence =</div><div class="line"> ~number percent of ~number |</div><div class="line"> call the nearest ~place |</div><div class="line"> how far away is ~place |</div><div class="line"> play more songs by this artist |</div><div class="line"> record a video |</div><div class="line"> start a timer for ~number minutes |</div><div class="line"> i&#39;m running low on gas |</div><div class="line"> cancel all my meetings on friday |</div><div class="line"> directions to ~place |</div><div class="line"> do i have any new texts |</div><div class="line"> open my calendar to next week |</div><div class="line"> set an alarm for ~number am tomorrow;</div><div class="line"></div><div class="line"># Match the prefix and zero or one of the sentences.</div><div class="line"># &lt;s&gt; and &lt;/s&gt; are sentence start and end markers that</div><div class="line"># match silence and small amounts of extraneous speech.</div><div class="line">g = &lt;s&gt; $prefix $sentence? &lt;/s&gt;;</div></div><!-- fragment --><div class="fragment"><div class="line"># number.txt</div><div class="line"># Example number class recognizer.</div><div class="line"></div><div class="line">g = 18 | 643 | 20 | 6;</div></div><!-- fragment --><div class="fragment"><div class="line"># place.txt</div><div class="line"># Example place name class recognizer.</div><div class="line"></div><div class="line">g = target | winco | susan&#39;s house;</div></div><!-- fragment --><p>Note how the "number" and "place" classes referenced in enrollments-class.txt create two new dynamic settings for these classes: <code>grammar-stream.number</code> and <code>grammar-stream.place</code>:</p>
<div class="fragment"><div class="line">$ snsr-eval -v -t model/lvcsr-build-enUS-2.7.0.snsr \</div><div class="line">    -s partial-result-interval=0 \</div><div class="line">    -f grammar-stream enrollments-class.txt \</div><div class="line">    -f grammar-stream.number number.txt \</div><div class="line">    -f grammar-stream.place place.txt \</div><div class="line">    data/enrollments/armadillo-1-0-c.wav</div><div class="line">   390   3210 (0.00 sv) armadillo 18 percent of 643</div></div><!-- fragment --><p>You could also create a partial recognizer, and fill in the remaining class slots at runtime:</p>
<div class="fragment"><div class="line">$ snsr-edit -v -t model/lvcsr-build-enUS-2.7.0.snsr \</div><div class="line">    -f grammar-stream enrollments-class.txt \</div><div class="line">    -f grammar-stream.number number.txt \</div><div class="line">    -o enrollments-class.snsr</div></div><!-- fragment --><div class="fragment"><div class="line">$ snsr-eval -v -t enrollments-class.snsr \</div><div class="line">    -s partial-result-interval=0 \</div><div class="line">    -f grammar-stream.number number.txt \</div><div class="line">    data/enrollments/armadillo-1-0-c.wav</div><div class="line">   390   3210 (0.00 sv) armadillo 18 percent of 643</div></div><!-- fragment --><h3><a class="anchor" id="class-lib"></a>
Binary class libraries</h3>
<p>TrulyHandsfree 6.15.0 introduced support for pre-built binary class repositories. These contain classes built from frequently used grammar fragments such as dates, times, and numbers.</p>
<p>Load binary class repositories into the same SnsrSession as an LVCSR build model to add this capability to the model. If a grammar references a class that's not explicity defined, the class name is looked up in the provided class library (or libraries). System class libraries provided by Sensory use a prefix of <code>s</code>. for all class names.</p>
<p>See <a class="el" href="models.html#lvcsr-lib-enUS">lvcsr-lib-enUS-1.2.0.snsr</a> for a list of classes used below.</p>
<div class="fragment"><div class="line"># class-lib.txt</div><div class="line"># Example recognizer with classes from a class library</div><div class="line">call = call {number ~s.phone-number};</div><div class="line">emergency = ~s.call-emergency;</div><div class="line">timer = {timer ~s.timer-phrases};</div><div class="line">commands = {call} | {emergency} | $timer;</div><div class="line">g = &lt;s&gt; $commands &lt;/s&gt;;</div></div><!-- fragment --><div class="fragment"><div class="line">$ snsr-eval -v \</div><div class="line">    -t model/lvcsr-build-enUS-2.7.0.snsr \</div><div class="line">    -t model/lvcsr-lib-enUS-1.2.0.snsr \</div><div class="line">    -f grammar-stream class-lib.txt \</div><div class="line">    -s leading-silence=5000 \</div><div class="line">    -s trailing-silence=1000 \</div><div class="line">    -s partial-result-interval=0</div><div class="line"></div><div class="line">Using live audio from default capture device. ^C to stop.</div><div class="line">  4125   7335 [^end] VAD speech region.</div><div class="line">NLU nlu-slot-value.call = call { number five five five one two three four five six seven }</div><div class="line">NLU nlu-slot-value.call.number = five five five one two three four five six seven</div><div class="line">  3780   7335 (0.00 sv) call five five five one two three four five six seven</div><div class="line"> 12510  14760 [^end] VAD speech region.</div><div class="line">NLU nlu-slot-value.timer = thirty minutes</div><div class="line"> 12510  14760 (0.00 sv) set a timer for thirty minutes</div><div class="line"> 37740  38925 [^end] VAD speech region.</div><div class="line">NLU nlu-slot-value.emergency = call fire department</div><div class="line"> 37740  39135 (0.00 sv) call fire department</div><div class="line">^C</div></div><!-- fragment --><h1><a class="anchor" id="build-code"></a>
Creating a recognizer using the API</h1>
<p>After loading a build-capable model (such as <em>lvcsr-build-enUS-2.7.0.snsr</em>), set <a class="el" href="group__task-spot.html#ga43b5ed48ada5a1574df79fc663194bcc">SNSR_GRAMMAR_STREAM</a> to a grammar specification, or set <a class="el" href="group__task-spot.html#gaf00523c2244f47f2ed9112e1bcf67d2e">SNSR_PHRASES_STREAM</a> to a list of phrases:</p>
<div class="fragment"><div class="line"><a class="code" href="group__session.html#ga1c1a58d3e64ee98c44d48c0b0e6ffd47">SnsrSession</a> s;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *phrases =</div><div class="line">  <span class="stringliteral">&quot;armadillo 18 percent of 643;&quot;</span></div><div class="line">  <span class="stringliteral">&quot;armadillo call the nearest target;&quot;</span></div><div class="line">  <span class="stringliteral">&quot;armadillo how far away is winco;&quot;</span></div><div class="line">  <span class="stringliteral">&quot;jackalope cancel all my meetings on friday;&quot;</span>;</div><div class="line"></div><div class="line"><a class="code" href="group__session.html#gaf800c6a2988ba52d316dd5c983f8e525">snsrNew</a>(&amp;s);</div><div class="line"><a class="code" href="group__session.html#gad1414facf04ffc64d77040d2d44bbe10">snsrLoad</a>(s, <a class="code" href="group__stream-provider.html#ga1cc5bbf5687b56b86a817db13c80bd70">snsrStreamFromFileName</a>(<span class="stringliteral">&quot;lvcsr-build-enUS-2.7.0.snsr&quot;</span>, <span class="stringliteral">&quot;r&quot;</span>));</div><div class="line"></div><div class="line"><span class="comment">/* Create a recognizer from a list of phrases held in a C string. */</span></div><div class="line"><a class="code" href="group__session.html#ga4e5da30fc837e4ac9c315b4e5985c631">snsrSetStream</a>(s, <a class="code" href="group__task-spot.html#gaf00523c2244f47f2ed9112e1bcf67d2e">SNSR_PHRASES_STREAM</a>, <a class="code" href="group__stream-provider.html#ga4b1d30b2afd363daf06a10505a85dc91">snsrStreamFromString</a>(phrases));</div><div class="line"></div><div class="line"><span class="comment">/* Elided: Set up SNSR_RESULT_EVENT handler, etc. */</span></div></div><!-- fragment --><h2><a class="anchor" id="build-code-class"></a>
Class-based recognition using the API</h2>
<p>See <a class="el" href="build.html#build-class">Class-based recognition</a> for a short description.</p>
<p>Populating a recognition class at runtime uses the same approach as creating an entire recognizer with the addition of specifying the class name.</p>
<p>Consider a top-level recognizer that includes a reference to a <code>~names</code> class which we want to configure at runtime, presumably after reading a contact list:</p>
<div class="fragment"><div class="line"><a class="code" href="group__session.html#ga1c1a58d3e64ee98c44d48c0b0e6ffd47">SnsrSession</a> s;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *names =</div><div class="line">  <span class="stringliteral">&quot;Liam; Olivia; Noah; Emma; Oliver; Charlotte; Elijah; Amelia; &quot;</span></div><div class="line">  <span class="stringliteral">&quot;James; Ava; William; Sophia; Benjamin; Isabella; Lucas; Mia; &quot;</span></div><div class="line">  <span class="stringliteral">&quot;Henry; Evelyn; Theodore; Harper;&quot;</span>;</div><div class="line"></div><div class="line"><span class="comment">/* Elided: Session setup, model loading etc. */</span></div><div class="line"></div><div class="line"><span class="comment">/* Set the ~names class */</span></div><div class="line"><a class="code" href="group__session.html#ga4e5da30fc837e4ac9c315b4e5985c631">snsrSetStream</a>(s, <a class="code" href="group__task-spot.html#gaf00523c2244f47f2ed9112e1bcf67d2e">SNSR_PHRASES_STREAM</a> <span class="stringliteral">&quot;names&quot;</span>, <a class="code" href="group__stream-provider.html#ga4b1d30b2afd363daf06a10505a85dc91">snsrStreamFromString</a>(names));</div></div><!-- fragment --><h1><a class="anchor" id="grammar-syntax"></a>
Grammar Specification Syntax</h1>
<h2><a class="anchor" id="grammar-syntax-overview"></a>
Overview</h2>
<p>A grammar specification is a set of rules that describe the sequence of words that make up the recognition language. The rules typically employ variables to represent sub-sequences of words. The following syntactic conventions are used to specify grammars:</p>
<ul>
<li>Grammars use <a href="https://en.wikipedia.org/wiki/UTF-8">UTF-8</a> encoding.</li>
<li><span class="tag">#</span> marks the start of a comment, which extends to the end of the line.</li>
<li>A grammar is a series of rules representing variable definitions, where the final rule represents the entire grammar.</li>
<li><span class="tag">$</span> A rule is of the form:<div class="fragment"><div class="line">X = a b ... z; </div></div><!-- fragment --> where <code>X</code> is the defined variable. The symbols <code>a b ... z</code> are either terminals (alphanumeric words not including whitespace or grammar operators, e.g. <code>meetings</code>) or variables (rules defined earlier in the grammar, referenced with a <code>$</code> sigil, e.g. <code>$cityName</code>).<ul>
<li>There's an implied <code>AND</code> operation between whitespace-separated symbols. With <code>g = one two three;</code> <code>one</code> must be followed by <code>two</code> and then <code>three</code> for the grammar to accept the input.</li>
<li>Each rule must terminate with a semicolon.</li>
<li>A rule must not reference itself either directly, or indirectly via other rules.</li>
<li>Substituted variables are implicity surrounded by parentheses: <code>a = 1 | 2 | 3; b = &lt;s&gt; $a &lt;/s&gt;;</code> is equivalent to <code>b = &lt;s&gt; (1 | 2 | 3) &lt;/s&gt;;</code>.</li>
</ul>
</li>
<li><span class="tag">( )</span> Parentheses enclose items that are grouped together.</li>
<li><span class="tag">[ ]</span> Square brackets enclose optional items.</li>
<li><span class="tag">?</span> A question mark following a symbol denotes an optional item.</li>
<li><span class="tag">+</span> A plus following a symbol (e.g. terminal or variable) denotes one or more repetitions</li>
<li><span class="tag">*</span> An asterisk following a symbol denotes zero or more repetitions (same as <code></code>[symbol+]).</li>
<li><span class="tag">|</span> A pipe symbol separates alternative items.</li>
<li><span class="tag">:</span> A terminal followed by a colon followed by another terminal forces the first terminal (before the colon) to be replaced in the output by the second terminal (following the colon). E.g. <code>one:1</code> would recognize one but return <code>1</code>.<ul>
<li><span class="tag">:terminal</span> emits <code>terminal</code> without consuming any input.</li>
<li><span class="tag">terminal:</span> consumes <code>terminal</code> without producing any output.</li>
<li><span class="tag">$rule:symbol</span> consumes all input from <code>$rule</code>, but produces only <code>symbol</code> as output. If <code>symbol</code> is omitted <code>$rule</code> produces no output.</li>
<li><span class="tag">~class:</span> consumes all input from the named class (and all classes it references), and produces no output.</li>
</ul>
</li>
<li><span class="tag">/</span> A forward slash following a symbol (e.g. terminal or variable) followed by a floating point number (e.g. <code>one/0.123</code>) defines a weight to be associated with that symbol. If a colon is present (followed by an output terminal) then the <code>/</code> comes after the output terminal (e.g. <code>one:1/0.123</code>).<ul>
<li>Each weight (w) used in a grammar represents a probability <code></code>(p) between <code>0.0</code> and <code>1.0</code> associated with the symbol to which the weight is attached. The weight formula is <code>w = -log10(p)</code>.</li>
</ul>
</li>
<li><span class="tag">~</span> A terminal that starts with a tilde specifies a recognition class.<ul>
<li>Each ~classname encountered in the <a class="el" href="group__task-spot.html#ga43b5ed48ada5a1574df79fc663194bcc">SNSR_GRAMMAR_STREAM</a> definition creates two new settings: <a class="el" href="group__task-spot.html#ga43b5ed48ada5a1574df79fc663194bcc">SNSR_GRAMMAR_STREAM</a> <code>"classname"</code> and <a class="el" href="group__task-spot.html#gaf00523c2244f47f2ed9112e1bcf67d2e">SNSR_PHRASES_STREAM</a> <code>"classname"</code> Use these to specify the grammar or phrase lists for each class.</li>
<li>Multiple references to the same class in the <a class="el" href="group__task-spot.html#ga43b5ed48ada5a1574df79fc663194bcc">SNSR_GRAMMAR_STREAM</a> specification share the same named recognizer model. For large grammars with many references to the same class this can reduce build time, and the size of the recognizer, when compared with the baseline grammar that uses a rule instead.</li>
<li>You can use classes to add custom recognition behavior to a large recognizer just before it is used. For example: Fill in <a class="el" href="group__task-spot.html#gaf00523c2244f47f2ed9112e1bcf67d2e">SNSR_PHRASES_STREAM</a> <code>"numbers"</code> with phone numbers retrieved from an address book.</li>
</ul>
</li>
<li><span class="tag">{ }</span> Braces implement slot-capturing lightweight NLU (semantic) markup.<ul>
<li><code>{slotName a b c}</code> will emit <code>{ slotName a b c }</code> if <code>a b c</code> is recognized.</li>
<li><code>{rule}</code> is shorthand for <code>{rule $rule}</code>.</li>
<li>With this grammar: <div class="fragment"><div class="line">seconds = 1 | 2 | 4 | 8 | half:0.5 a:? | a:? quarter:0.25 [of: a:];</div><div class="line">shutterSpeed = set shutter speed to {seconds} ( second | seconds );</div><div class="line">cmd = &lt;s&gt; {shutterSpeed} &lt;/s&gt;;</div></div><!-- fragment --> an utterance of "set shutter speed to a quarter of a second" will produce <code>set shutter speed to a quarter of a second</code> as recognition output, with an additional <a class="el" href="group__task-spot.html#ga431c4a156b920e2422b1ffefa3791960">SNSR_NLU_SLOT_EVENT</a> callback for the top-level <code>shutterSpeed</code> slot: <div class="fragment"><div class="line">NLU shutterSpeed = set shutter speed to { seconds 0.25 } second</div><div class="line">NLU shutterSpeed.seconds = 0.25</div></div><!-- fragment --></li>
</ul>
</li>
<li>To include a literal special token in a grammar specification, escape it with a backslash, <code>\</code>. The list of tokens that support this include: <span class="tag">^</span>, <span class="tag">|</span>, <span class="tag">*</span>, <span class="tag">+</span>, <span class="tag">?</span>, <span class="tag">=</span>, <span class="tag">[ ]</span>, <span class="tag">( )</span>, <span class="tag">;</span>, <span class="tag">#</span>, and <span class="tag">:</span>.</li>
<li><span class="tag">^</span> Logical AND operator. This is a symbol reserved for internal use.</li>
<li><dl class="deprecated"><dt><b><a class="el" href="deprecated.html#_deprecated000001">Deprecated:</a></b></dt><dd><span class="tag">@</span> superseded by <span class="tag">:terminal</span>. Do not use <span class="tag">@</span> in new projects.</dd></dl>
</li>
</ul>
<h2><a class="anchor" id="grammar-op-prec"></a>
Operator precedence</h2>
<p>The following table lists the precedence and associativity of custom grammar operators. Operators are listed top to bottom, in decending precedence.</p>
<table class="doxtable oprec">
<tr>
<th>Precedence </th><th>Operator </th><th>Description </th><th>Associativity  </th></tr>
<tr>
<td rowspan="2">0 </td><td><span class="tag">:</span> </td><td>Rewrite output </td><td></td></tr>
<tr>
<td><span class="tag">/</span> </td><td>Symbol weight </td><td></td></tr>
<tr>
<td rowspan="3">1 </td><td><span class="tag">( )</span> </td><td>Grouping </td><td></td></tr>
<tr>
<td><span class="tag">[ ]</span> </td><td>Optional group </td><td></td></tr>
<tr>
<td><span class="tag">{ }</span> </td><td>Slot-capturing semantic markup </td><td></td></tr>
<tr>
<td rowspan="3">2 </td><td><span class="tag">?</span> </td><td>Zero-or-one symbol </td><td>left-to-right  </td></tr>
<tr>
<td><span class="tag">+</span> </td><td>One-or-more symbols </td><td>left-to-right  </td></tr>
<tr>
<td><span class="tag">*</span> </td><td>Zero-or-more symbols </td><td>left-to-right  </td></tr>
<tr>
<td>3 </td><td><span class="tag">^</span> </td><td>and, implied between symbols </td><td>right-to-left  </td></tr>
<tr>
<td>4 </td><td><span class="tag">|</span> </td><td>or </td><td>right-to-left  </td></tr>
<tr>
<td>5 </td><td><span class="tag">=</span> </td><td>rule assignment </td><td>right-to-left  </td></tr>
</table>
<p>This grammar:</p>
<div class="fragment"><div class="line">a = one | two three four;</div><div class="line">g = &lt;s&gt; ( $a | five six) &lt;/s&gt;;</div></div><!-- fragment --><p>will recognize only these phrases:</p>
<div class="fragment"><div class="line">one</div><div class="line">two three four</div><div class="line">five six</div></div><!-- fragment --><h2><a class="anchor" id="grammar-symbols"></a>
Special symbols</h2>
<p>A grammar can include these special symbols:</p><ul>
<li><span class="tag">&lt;s&gt;</span> - The silence at the start of a sentence.</li>
<li><span class="tag">&lt;/s&gt;</span> - The silence at the end of a sentence.</li>
<li><span class="tag">&lt;wp&gt;</span> - Short pauses between words. The grammar compiler automatically adds these where needed, so there is no need to do so explicitly. Do <b>not</b> add <span class="tag">&lt;wp&gt;</span> to NLU grammars, use <span class="tag">&lt;pause/&gt;</span> instead.</li>
<li><span class="tag">&lt;pause/&gt;</span> - A explicit short pause.</li>
<li><span class="tag">&lt;no-match/&gt;</span> - Matches when none of the alternatives are likely (i.e. "none of the above").<ul>
<li>Recognition results at the phrase level can include <code>&lt;no-match/&gt;</code> even if this symbol was not explicilty used in the grammar. This is an indication that the result was rejected due to <a class="el" href="group__task-spot.html#ga95bc2989af4d183d3eec0cd8a0f76181">SNSR_OOV_REJECT</a>, or that RAM or CPU constraints limited the recognizer's ability to produce a result.</li>
</ul>
</li>
<li><span class="tag">&lt;unknown/&gt;</span> - Similar to <span class="tag">&lt;no-match/&gt;</span>. In <em>some</em> models the threshold for determining whether this symbol maches better than any other is different from that of <span class="tag">&lt;no-match/&gt;</span>.</li>
<li><span class="tag">.</span> - When used with lightweight NLU grammars (<a class="el" href="group__task-spot.html#gae27562b74e0b3df3100e5bf96aa2ee1f">SNSR_NLU_GRAMMAR_STREAM</a>) a single period matches any input word. Use <code></code>.:* to match any input words and remove them from the NLU result. </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
    Copyright &copy;2002-2025
    <a href="http://www.sensory.com/">Sensory Inc.</a>
    (Mon Feb 17 2025)
    <span class="confidential">
      <a href="license.html">Sensory Confidential</a>
    </span>
    </li>
  </ul>
</div>
</body>
</html>
